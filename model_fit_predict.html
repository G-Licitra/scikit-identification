<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Using a non-linear model to fit to predictors and predict a target &#8212; scikit-identification 0.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Available out of box models" href="models.html" />
    <link rel="prev" title="skmid.integrator" href="usage.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          scikit-identification</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html"><code class="docutils literal notranslate"><span class="pre">skmid.integrator</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#skmid-load-system"><code class="docutils literal notranslate"><span class="pre">skmid.load_system</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#skmid-model-training"><code class="docutils literal notranslate"><span class="pre">skmid.model_training</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#skmid-models"><code class="docutils literal notranslate"><span class="pre">skmid.models</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notebooks</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using a non-linear model to fit to predictors and predict a target</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Available out of box models</a></li>
<li class="toctree-l1"><a class="reference internal" href="lorenz.html">Lorenz Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrator.html">Integrator Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tests.html"><code class="docutils literal notranslate"><span class="pre">tests.integrator.test_runge_kutta_4</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html#tests-models-test-dynamic-model"><code class="docutils literal notranslate"><span class="pre">tests.models.test_dynamic_model</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html#tests-models-test-generate-model-parameters"><code class="docutils literal notranslate"><span class="pre">tests.models.test_generate_model_parameters</span></code></a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Using a non-linear model to fit to predictors and predict a target</a><ul>
<li><a class="reference internal" href="#This-is-an-example-of-a-single-input-single-output-system-(SISO)">This is an example of a single input single output system (SISO)</a></li>
<li><a class="reference internal" href="#Read-in-the-data">Read in the data</a></li>
<li><a class="reference internal" href="#Define-the-model-(generate-the-attributes,-and-set-the-model-with-the-defined-attributes)">Define the model (generate the attributes, and set the model with the defined attributes)</a></li>
<li><a class="reference internal" href="#Define-the-input-settings">Define the input settings</a></li>
<li><a class="reference internal" href="#Call-the-estimator-(here-Least-Squares-Regression-is-used)">Call the estimator (here Least Squares Regression is used)</a></li>
<li><a class="reference internal" href="#Create-initial-condition">Create initial condition</a></li>
<li><a class="reference internal" href="#Estimate-parameters">Estimate parameters</a></li>
<li><a class="reference internal" href="#Fit-the-model">Fit the model</a></li>
<li><a class="reference internal" href="#Save-the-output-(parameter-estimates,-predictions-and-model-fit)">Save the output (parameter estimates, predictions and model fit)</a></li>
<li><a class="reference internal" href="#Compare-the-estimated-parameters-vs-the-initial-guessed-parameters">Compare the estimated parameters vs the initial guessed parameters</a></li>
<li><a class="reference internal" href="#Save-the-input,-actual-target-and-prediction-in-a-data-frame">Save the input, actual target and prediction in a data frame</a></li>
<li><a class="reference internal" href="#Plot-the-first-500-data-points-to-get-an-idea-of-how-close-the-real-target-and-the-prediction-are">Plot the first 500 data points to get an idea of how close the real target and the prediction are</a></li>
<li><a class="reference internal" href="#Use-the-RMSE-to-quantify-the-difference-between-the-real-and-predicted-target">Use the RMSE to quantify the difference between the real and predicted target</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Using-a-non-linear-model-to-fit-to-predictors-and-predict-a-target">
<h1>Using a non-linear model to fit to predictors and predict a target<a class="headerlink" href="#Using-a-non-linear-model-to-fit-to-predictors-and-predict-a-target" title="Permalink to this headline">¶</a></h1>
<section id="This-is-an-example-of-a-single-input-single-output-system-(SISO)">
<h2>This is an example of a single input single output system (SISO)<a class="headerlink" href="#This-is-an-example-of-a-single-input-single-output-system-(SISO)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="n">current_wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">current_wd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;scikit-identification&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;scikit-identification&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">skmid.integrator</span> <span class="kn">import</span> <span class="n">RungeKutta4</span>
<span class="kn">from</span> <span class="nn">skmid.model_training</span> <span class="kn">import</span> <span class="n">DynamicModel</span><span class="p">,</span> <span class="n">LeastSquaresRegression</span>
<span class="kn">from</span> <span class="nn">skmid.models</span> <span class="kn">import</span> <span class="n">generate_model_attributes</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">current_wd</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;skmid&quot;</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">available</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;skmid&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Read-in-the-data">
<h2>Read in the data<a class="headerlink" href="#Read-in-the-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/non_linear_model/u_data.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/non_linear_model/y_data.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;y&quot;</span><span class="p">]]</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;u&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Define-the-model-(generate-the-attributes,-and-set-the-model-with-the-defined-attributes)">
<h2>Define the model (generate the attributes, and set the model with the defined attributes)<a class="headerlink" href="#Define-the-model-(generate-the-attributes,-and-set-the-model-with-the-defined-attributes)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span> <span class="o">=</span> <span class="n">generate_model_attributes</span><span class="p">(</span>
    <span class="n">state_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">input_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parameter_size</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
<span class="n">y</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">u</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">M</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">k_NL</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="p">[</span><span class="n">dy</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">k_NL</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">k</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">/</span> <span class="n">M</span><span class="p">]</span> <span class="c1"># this is where the main equation is defined</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">DynamicModel</span><span class="p">(</span>
    <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
    <span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span>
    <span class="n">parameter</span><span class="o">=</span><span class="n">param</span><span class="p">,</span>
    <span class="n">input_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">],</span>
    <span class="n">parameter_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;k_NL&quot;</span><span class="p">],</span>
    <span class="n">state_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;dy&quot;</span><span class="p">],</span>
    <span class="n">output</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
    <span class="n">model_dynamics</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Define-the-input-settings">
<h2>Define the input settings<a class="headerlink" href="#Define-the-input-settings" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="s2">&quot;fs&quot;</span><span class="p">:</span> <span class="mf">610.1</span><span class="p">,</span>
    <span class="s2">&quot;param_truth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.625e-6</span><span class="p">,</span> <span class="mf">2.3e-4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">4.69</span><span class="p">],</span>
    <span class="s2">&quot;param_guess&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;n_steps_per_sample&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;initial_condition&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="Call-the-estimator-(here-Least-Squares-Regression-is-used)">
<h2>Call the estimator (here Least Squares Regression is used)<a class="headerlink" href="#Call-the-estimator-(here-Least-Squares-Regression-is-used)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fs&quot;</span><span class="p">]</span>
<span class="n">n_steps_per_sample</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;n_steps_per_sample&quot;</span><span class="p">]</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">LeastSquaresRegression</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">n_steps_per_sample</span><span class="o">=</span><span class="n">n_steps_per_sample</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Create-initial-condition">
<h2>Create initial condition<a class="headerlink" href="#Create-initial-condition" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Yg</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">yd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Yg</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">fs</span>
<span class="n">yd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">yd</span><span class="p">,</span> <span class="n">yd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">state_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">Yg</span><span class="p">,</span> <span class="n">yd</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Estimate-parameters">
<h2>Estimate parameters<a class="headerlink" href="#Estimate-parameters" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_guess</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;param_guess&quot;</span><span class="p">]</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Fit-the-model">
<h2>Fit the model<a class="headerlink" href="#Fit-the-model" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">param_guess</span><span class="o">=</span><span class="n">param_guess</span><span class="p">,</span> <span class="n">param_scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
    <span class="n">state_guess</span><span class="o">=</span><span class="n">state_guess</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
just-in-time compilation with compiler= &#34;shell&#34;

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

This is Ipopt version 3.12.3, running with linear solver mumps.
NOTE: Other linear solvers might be more efficient (see Ipopt documentation).

Number of nonzeros in equality constraint Jacobian...:   139986
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:   110010

Total number of variables............................:    20004
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:    19998
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  7.6523348e+00 3.64e+01 2.90e-04  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.2891655e-02 8.22e+00 1.27e-01  -1.0 9.25e+01    -  1.00e+00 1.00e+00h  1
   2  3.0913862e-03 8.84e-01 4.05e-02  -1.0 5.52e+00    -  1.00e+00 1.00e+00h  1
   3  1.5447642e-06 2.16e-02 4.94e-04  -1.7 2.49e+00    -  1.00e+00 1.00e+00h  1
   4  7.1764288e-14 1.08e-05 1.01e-08  -3.8 8.46e-02    -  1.00e+00 1.00e+00h  1
   5  6.2577159e-28 6.96e-13 5.30e-16  -8.6 1.68e-05    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 5

                                   (scaled)                 (unscaled)
Objective...............:   6.2577158927766514e-28    6.2577158927766514e-28
Dual infeasibility......:   5.2990251635765292e-16    5.2990251635765292e-16
Constraint violation....:   2.3107461729977349e-13    6.9633188104489818e-13
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   2.3107461729977349e-13    6.9633188104489818e-13


Number of objective function evaluations             = 6
Number of objective gradient evaluations             = 6
Number of equality constraint evaluations            = 6
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 6
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 5
Total CPU secs in IPOPT (w/o function evaluations)   =      1.365
Total CPU secs in NLP function evaluations           =      4.591

EXIT: Optimal Solution Found.
      solver  :   t_proc      (avg)   t_wall      (avg)    n_eval
       nlp_f  | 192.05ms ( 32.01ms) 192.43ms ( 32.07ms)         6
       nlp_g  | 196.76ms ( 32.79ms) 197.45ms ( 32.91ms)         6
  nlp_grad_f  | 964.95ms (137.85ms) 971.97ms (138.85ms)         7
  nlp_hess_l  |   1.31 s (261.10ms)   1.31 s (262.74ms)         5
   nlp_jac_g  |   2.45 s (350.68ms)   2.46 s (351.84ms)         7
       total  |   6.02 s (  6.02 s)   6.04 s (  6.04 s)         1
</pre></div></div>
</div>
</section>
<section id="Save-the-output-(parameter-estimates,-predictions-and-model-fit)">
<h2>Save the output (parameter estimates, predictions and model fit)<a class="headerlink" href="#Save-the-output-(parameter-estimates,-predictions-and-model-fit)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_est</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">coef_</span>

<span class="n">y_fit</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">initial_condition</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">state_guess</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>

<span class="n">x_fit</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">model_fit_</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
INFO:The input index has a different fs than specified in the object.
                                  The input index has been modified by using fs=610.1 Hz.

</pre></div></div>
</div>
</section>
<section id="Compare-the-estimated-parameters-vs-the-initial-guessed-parameters">
<h2>Compare the estimated parameters vs the initial guessed parameters<a class="headerlink" href="#Compare-the-estimated-parameters-vs-the-initial-guessed-parameters" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_est</span><span class="p">,</span> <span class="n">param_guess</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([5.625e-06, 2.300e-04, 1.000e+00, 4.690e+00]), [5, 2, 1, 5])
</pre></div></div>
</div>
</section>
<section id="Save-the-input,-actual-target-and-prediction-in-a-data-frame">
<h2>Save the input, actual target and prediction in a data frame<a class="headerlink" href="#Save-the-input,-actual-target-and-prediction-in-a-data-frame" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="n">U</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">Y</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
              <span class="s2">&quot;y_predict&quot;</span><span class="p">:</span> <span class="n">y_fit</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]})</span>
</pre></div>
</div>
</div>
</section>
<section id="Plot-the-first-500-data-points-to-get-an-idea-of-how-close-the-real-target-and-the-prediction-are">
<h2>Plot the first 500 data points to get an idea of how close the real target and the prediction are<a class="headerlink" href="#Plot-the-first-500-data-points-to-get-an-idea-of-how-close-the-real-target-and-the-prediction-are" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pred_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="p">),</span>
                 <span class="n">x</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="p">,</span>
                 <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                 <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/model_fit_predict_25_0.png" src="_images/model_fit_predict_25_0.png" />
</div>
</div>
</section>
<section id="Use-the-RMSE-to-quantify-the-difference-between-the-real-and-predicted-target">
<h2>Use the RMSE to quantify the difference between the real and predicted target<a class="headerlink" href="#Use-the-RMSE-to-quantify-the-difference-between-the-real-and-predicted-target" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">pred_df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">pred_df</span><span class="p">[</span><span class="s2">&quot;y_predict&quot;</span><span class="p">])),</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.00142
</pre></div></div>
</div>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/model_fit_predict.nblink.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2022, Giovanni Licitra, James Twose.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>